<div class="container">
<div class="banner" style="background-image: linear-gradient(rgba(0,0,0,0.4),rgba(0,0,0,0.4)), url(<%= cl_image_path @profile.photo.key if @profile.photo.attached? %>);">
   <div style="display: flex; justify-content: space-between; align-items: flex-end" class="container">
    <h1><%= @profile.name %></h1>
    <p><%= @profile.bio if @profile.bio %></p>
  
  <%= link_to "👥", profiles_path %>
    <% if @profile.user == current_user %>
      <%= link_to "✏️", edit_profile_path %>
  <% end %>
  </div>
  <%# FRIENDSHIP BUTTON START %>
  <% if @profile.user != current_user %>
    <% if @friendship.status == "accepted" %>
      <div class="dropdown">
        <button class="btn btn-success dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Friend
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <%= link_to "Unfriend", friendship_path(@friendship), data: { confirm: 'Are you sure?'}, method: :delete, remote: true, class: "dropdown-item" %>
        </div>
      </div>
    <% elsif @friendship.asker == current_user && @friendship.status == "pending" %>
      <div class="dropdown">
        <button class="btn btn-success dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          &check; Request Sent
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <%= link_to "Cancel", friendship_path(@friendship), data: { confirm: 'Are you sure?'}, method: :delete, remote: true, class: "dropdown-item" %>
        </div>
      </div>
    <% elsif @friendship.status == "rejected" %>
      <button type="button" class="btn btn-outline-warning">Please make another request in 14 days. Or send this person a message.</button>
    <% elsif @friendship.receiver == current_user && @friendship.status == "pending" %>
      <div class="dropdown">
      <button class="btn btn-warning dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Respond
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <%= link_to "Accept", friendship_path(@friendship, friendship: { status: 'accepted' }), method: :patch, class: "dropdown-item" %>
        <%= link_to "Deny", friendship_path(@friendship, friendship: { status: 'rejected' }), data: { confirm: 'Are you sure?'}, method: :patch, class: "dropdown-item" %>
      </div>
    </div>
    <% else %>
      <%= link_to "Add Friend", profile_friendships_path([@profile, @friendship], friendship: { status: 'pending' }), method: :post, remote: true, class: "btn btn-primary" %>
    <% end %>
  <% end %>
  <%# FRIENDSHIP BUTTON END %>


  <%# CHAT BUTTON START %>
  <% if @profile.user != current_user %>
    <% if @chat.id.nil? %>
      <%= link_to "Message", profile_chats_path([@profile, @chat]), method: :post, class: "btn btn-primary" %>
    <% else %>
      <%= link_to "Message", chat_path(@chat), class: "btn btn-primary" %>
    <% end %>
  <% end %>
  <%# CHAT BUTTON END %>
  </div>
</div>

<div style="display: flex; justify-content: space-between" class="container">
  <h5>I speak:</h5> </div><div style="display: flex; justify-content: flex-end" class="container">
  <%= @profile.address if @profile.address %>

</div>
<div style="display: flex; justify-content: absolute" class="container">
  <p><%= @profile.native_language if @profile.native_language %>
  <% if @profile.second_language? %>
     <%= @profile.second_language %></p>
  <% end %>
</div>

<div style="display: flex; justify-content: flex-start" class="container">
  
  <% @profile.diseases.each do |disease| %>
     <p>I´m living with: <%= disease.name %> </p>
     <% end %>
  
</div>

<div class="container">
  <h1 class="text-center">My Posts</h1>
</div>

<div class="container">
  <%= render 'post', posts: @posts %>
</div>
